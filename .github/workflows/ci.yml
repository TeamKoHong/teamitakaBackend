name: CI Pipeline

on:
  push:
    branches: [dev, 'feature/*']
  pull_request:
    branches: [dev]

jobs:
  build-and-deploy-test:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write

    env:
      GCP_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
      IMAGE_NAME: teamitaka-backend

    steps:
      # 1. Checkout
      - name: Checkout Repository
        uses: actions/checkout@v3

      # 2. Setup Node.js
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      # 3. Install dependencies
      - name: Install Dependencies
        run: npm ci

      # 4.1. Ensure Database Exists (Cloud SQL)
      - name: Ensure Database Exists
        run: |
          echo "üîç Ensuring database exists on Cloud SQL..."
          mysql -h ${{ secrets.DB_HOST }} -u ${{ secrets.DB_USER }} -p${{ secrets.DB_PASSWORD }} -e "CREATE DATABASE IF NOT EXISTS \`${{ secrets.DB_NAME }}\` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;"
        env:
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          DB_NAME: ${{ secrets.DB_NAME }}

      # 4. Database Setup (Development/Test Environment)
      - name: Setup Database for Testing
        run: |
          echo "üîß Setting up database for testing environment..."
          echo "DB_HOST: ${{ secrets.DB_HOST }}"
          echo "DB_USER: ${{ secrets.DB_USER }}"
          echo "DB_NAME: ${{ secrets.DB_NAME }}"
          echo "DB_PORT: ${{ secrets.DB_PORT }}"
          
          # ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
          export NODE_ENV=development
          export DB_HOST=${{ secrets.DB_HOST }}
          export DB_USER=${{ secrets.DB_USER }}
          export DB_PASSWORD=${{ secrets.DB_PASSWORD }}
          export DB_NAME=${{ secrets.DB_NAME }}
          export DB_PORT=${{ secrets.DB_PORT }}
          export JWT_SECRET=${{ secrets.JWT_SECRET || 'default-jwt-secret-for-testing' }}
          
          # DB Ï¥àÍ∏∞Ìôî Ïã§Ìñâ
          npm run db:init:simple:dev
        env:
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_PORT: ${{ secrets.DB_PORT }}
          JWT_SECRET: ${{ secrets.JWT_SECRET || 'default-jwt-secret-for-testing' }}

      # 5. API Tests (Optional - if you have tests)
      - name: Run API Tests
        run: |
          echo "üß™ Running API tests..."
          # Ïó¨Í∏∞Ïóê API ÌÖåÏä§Ìä∏ Ï∂îÍ∞Ä Í∞ÄÎä•
          echo "‚úÖ API tests completed (placeholder)"
        continue-on-error: true

      # 6. Authenticate with gcloud
      - name: Authenticate with gcloud
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}

      # 7. Set up gcloud CLI
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v1
        with:
          project_id: ${{ secrets.GCP_PROJECT_ID }}

      # 8. Configure Docker for Artifact Registry
      - name: Configure Docker
        run: gcloud auth configure-docker us-central1-docker.pkg.dev

      # 9. Build Docker image
      - name: Build Docker Image
        run: |
          docker build -t us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }} -f Dockerfile.prod .

      # 10. Push to Artifact Registry
      - name: Push Docker Image
        run: |
          docker push us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }}

      # 11. Deploy to Cloud Run
      - name: Deploy to Cloud Run
        id: deploy
        run: |
          echo "üîç Checking environment variables..."
          echo "DB_HOST: ${{ secrets.DB_HOST }}"
          echo "DB_USER: ${{ secrets.DB_USER }}"
          echo "DB_NAME: ${{ secrets.DB_NAME }}"
          echo "DB_PORT: ${{ secrets.DB_PORT }}"
          echo "JWT_SECRET: ${{ secrets.JWT_SECRET && 'SET' || 'NOT SET' }}"
          
          # JWT_SECRETÏù¥ ÏûàÏúºÎ©¥ Ìè¨Ìï®, ÏóÜÏúºÎ©¥ Ï†úÏô∏
          if [ -n "${{ secrets.JWT_SECRET }}" ]; then
            ENV_VARS="NODE_ENV=production,JWT_SECRET=${{ secrets.JWT_SECRET }},DB_HOST=${{ secrets.DB_HOST }},DB_USER=${{ secrets.DB_USER }},DB_PASSWORD=${{ secrets.DB_PASSWORD }},DB_NAME=${{ secrets.DB_NAME }},DB_PORT=${{ secrets.DB_PORT }}"
            echo "‚úÖ JWT_SECRET included in environment variables"
          else
            ENV_VARS="NODE_ENV=production,DB_HOST=${{ secrets.DB_HOST }},DB_USER=${{ secrets.DB_USER }},DB_PASSWORD=${{ secrets.DB_PASSWORD }},DB_NAME=${{ secrets.DB_NAME }},DB_PORT=${{ secrets.DB_PORT }}"
            echo "‚ö†Ô∏è  JWT_SECRET not set, using default value"
          fi
          
          gcloud run deploy ${{ env.IMAGE_NAME }} \
            --image us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }} \
            --platform managed \
            --region us-central1 \
            --allow-unauthenticated \
            --add-cloudsql-instances ${{ secrets.INSTANCE_CONNECTION_NAME }} \
            --set-env-vars "$ENV_VARS" \
            --format "value(status.url)" > service_url.txt
          
          echo "service_url=$(cat service_url.txt)" >> $GITHUB_OUTPUT
          echo "üîç Service URL: $(cat service_url.txt)"

      # 11.1. Ensure Database Exists (Cloud SQL)
      - name: Ensure Database Exists
        run: |
          echo "üîç Ensuring database exists on Cloud SQL..."
          mysql -h ${{ secrets.DB_HOST }} -u ${{ secrets.DB_USER }} -p${{ secrets.DB_PASSWORD }} -e "CREATE DATABASE IF NOT EXISTS \`${{ secrets.DB_NAME }}\` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;"

      # 11.2. Drop All Tables (Reset Database Schema)
      - name: Drop All Tables (Reset Database Schema)
        run: |
          echo "üóëÔ∏è  Dropping all existing tables to reset database schema..."
          docker run --rm \
            -e NODE_ENV=production \
            -e GCP_DB_HOST=${{ secrets.DB_HOST }} \
            -e GCP_DB_USER=${{ secrets.DB_USER }} \
            -e GCP_DB_PASSWORD=${{ secrets.DB_PASSWORD }} \
            -e GCP_DB_NAME=${{ secrets.DB_NAME }} \
            -e DB_PORT=${{ secrets.DB_PORT }} \
            -e JWT_SECRET=${{ secrets.JWT_SECRET }} \
            us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }} \
            node scripts/drop-all-tables.js

      # 11.3. Run Migrations (Production)
      - name: Run Migrations (Production)
        run: |
          echo "üîß Running migrations in production..."
          docker run --rm \
            -e NODE_ENV=production \
            -e GCP_DB_HOST=${{ secrets.DB_HOST }} \
            -e GCP_DB_USER=${{ secrets.DB_USER }} \
            -e GCP_DB_PASSWORD=${{ secrets.DB_PASSWORD }} \
            -e GCP_DB_NAME=${{ secrets.DB_NAME }} \
            -e DB_PORT=${{ secrets.DB_PORT }} \
            -e JWT_SECRET=${{ secrets.JWT_SECRET }} \
            us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }} \
            npx sequelize-cli db:migrate

      # 11.5. Initialize DB Tables and Insert Sample Data (Production)
      - name: Initialize DB Tables and Insert Sample Data (Production)
        run: |
          echo "üîß Initializing DB tables and inserting sample data in production..."
          docker run --rm \
            -e NODE_ENV=production \
            -e GCP_DB_HOST=${{ secrets.DB_HOST }} \
            -e GCP_DB_USER=${{ secrets.DB_USER }} \
            -e GCP_DB_PASSWORD=${{ secrets.DB_PASSWORD }} \
            -e GCP_DB_NAME=${{ secrets.DB_NAME }} \
            -e DB_PORT=${{ secrets.DB_PORT }} \
            -e JWT_SECRET=${{ secrets.JWT_SECRET }} \
            us-central1-docker.pkg.dev/${{ secrets.GCP_PROJECT_ID }}/${{ env.IMAGE_NAME }}/${{ env.IMAGE_NAME }} \
            node scripts/init-db.js

      # 12. Wait for service to be ready + Health Check
      - name: Wait and Check Health
        run: |
          echo "üîç Cloud Run service URL: ${{ steps.deploy.outputs.service_url }}"
          echo "‚è≥ Waiting for service to be ready..."
          sleep 60
          echo "üè• Attempting health check..."
          curl -f "${{ steps.deploy.outputs.service_url }}/health" || {
            echo "‚ùå Health check failed - Database connection is required for deployment success"
            echo "üìã Service URL: ${{ steps.deploy.outputs.service_url }}"
            echo "üìã Recent logs:"
            gcloud logging read "resource.type=cloud_run_revision AND resource.labels.service_name=${{ env.IMAGE_NAME }}" --limit=20 --format="value(timestamp,textPayload)"
            echo "‚ùå Deployment failed: Application cannot connect to database"
            echo "üí° Please check GitHub Secrets for database environment variables:"
            echo "   - DB_HOST"
            echo "   - DB_USER" 
            echo "   - DB_PASSWORD"
            echo "   - DB_NAME"
            echo "   - DB_PORT (optional)"
            exit 1
          }
          echo "‚úÖ Health check passed! Database connection successful."

      # 13. API Test with Seed Data
      - name: Test API with Seed Data
        run: |
          echo "üß™ Testing API endpoints with seed data..."
          SERVICE_URL="${{ steps.deploy.outputs.service_url }}"
          
          # ÌÖåÏä§Ìä∏ ÏÇ¨Ïö©ÏûêÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏó¨ ÌÜ†ÌÅ∞ ÌöçÎìù
          echo "üîê Testing login with seed user..."
          LOGIN_RESPONSE=$(curl -s -X POST "$SERVICE_URL/api/auth/login" \
            -H "Content-Type: application/json" \
            -d '{"email":"test@example.com","password":"password"}')
          
          echo "Login response: $LOGIN_RESPONSE"
          
          # ÌÜ†ÌÅ∞ Ï∂îÏ∂ú (Í∞ÑÎã®Ìïú Î∞©Î≤ï)
          TOKEN=$(echo $LOGIN_RESPONSE | grep -o '"token":"[^"]*"' | cut -d'"' -f4)
          
          if [ -n "$TOKEN" ]; then
            echo "‚úÖ Login successful, testing all seed data endpoints..."
            
            # 1. ÏÇ¨Ïö©Ïûê Í¥ÄÎ†® ÌÖåÏä§Ìä∏
            echo "üë§ Testing user endpoints..."
            USER_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/user")
            echo "Users found: $(echo $USER_RESPONSE | jq '. | length' 2>/dev/null || echo 'N/A')"
            
            # 2. Î™®ÏßëÍ≥µÍ≥† Ï°∞Ìöå ÌÖåÏä§Ìä∏
            echo "üìã Testing recruitment list..."
            RECRUITMENT_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/recruitments")
            RECRUITMENT_COUNT=$(echo $RECRUITMENT_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
            echo "Recruitments found: $RECRUITMENT_COUNT"
            
            # 3. ÌîÑÎ°úÏ†ùÌä∏ Ï°∞Ìöå ÌÖåÏä§Ìä∏
            echo "üìã Testing project list..."
            PROJECT_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/projects")
            PROJECT_COUNT=$(echo $PROJECT_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
            echo "Projects found: $PROJECT_COUNT"
            
            # 4. ÎåìÍ∏Ä Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ Î™®ÏßëÍ≥µÍ≥†Ïùò ÎåìÍ∏Ä)
            if [ "$RECRUITMENT_COUNT" -gt 0 ]; then
              echo "üí¨ Testing comment endpoints..."
              FIRST_RECRUITMENT_ID=$(echo $RECRUITMENT_RESPONSE | jq -r '.[0].recruitment_id' 2>/dev/null)
              if [ "$FIRST_RECRUITMENT_ID" != "null" ] && [ -n "$FIRST_RECRUITMENT_ID" ]; then
                COMMENT_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/comment/$FIRST_RECRUITMENT_ID")
                COMMENT_COUNT=$(echo $COMMENT_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Comments found: $COMMENT_COUNT"
              fi
            fi
            
            # 5. ÏßÄÏõê Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ Î™®ÏßëÍ≥µÍ≥†Ïùò ÏßÄÏõêÏûê)
            if [ "$RECRUITMENT_COUNT" -gt 0 ]; then
              echo "üìù Testing application endpoints..."
              FIRST_RECRUITMENT_ID=$(echo $RECRUITMENT_RESPONSE | jq -r '.[0].recruitment_id' 2>/dev/null)
              if [ "$FIRST_RECRUITMENT_ID" != "null" ] && [ -n "$FIRST_RECRUITMENT_ID" ]; then
                APPLICATION_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/applications/$FIRST_RECRUITMENT_ID")
                APPLICATION_COUNT=$(echo $APPLICATION_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Applications found: $APPLICATION_COUNT"
              fi
            fi
            
            # 6. Î¶¨Î∑∞ Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏Ïùò Î¶¨Î∑∞)
            if [ "$PROJECT_COUNT" -gt 0 ]; then
              echo "‚≠ê Testing review endpoints..."
              FIRST_PROJECT_ID=$(echo $PROJECT_RESPONSE | jq -r '.[0].project_id' 2>/dev/null)
              if [ "$FIRST_PROJECT_ID" != "null" ] && [ -n "$FIRST_PROJECT_ID" ]; then
                REVIEW_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/reviews/project/$FIRST_PROJECT_ID")
                REVIEW_COUNT=$(echo $REVIEW_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Reviews found: $REVIEW_COUNT"
              fi
            fi
            
            # 7. ÌåÄÏõê Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏Ïùò ÌåÄÏõê)
            if [ "$PROJECT_COUNT" -gt 0 ]; then
              echo "üë• Testing team member endpoints..."
              FIRST_PROJECT_ID=$(echo $PROJECT_RESPONSE | jq -r '.[0].project_id' 2>/dev/null)
              if [ "$FIRST_PROJECT_ID" != "null" ] && [ -n "$FIRST_PROJECT_ID" ]; then
                MEMBER_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/projects/$FIRST_PROJECT_ID/members")
                MEMBER_COUNT=$(echo $MEMBER_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Team members found: $MEMBER_COUNT"
              fi
            fi
            
            # 8. Todo Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏Ïùò Ìï† Ïùº)
            if [ "$PROJECT_COUNT" -gt 0 ]; then
              echo "‚úÖ Testing todo endpoints..."
              FIRST_PROJECT_ID=$(echo $PROJECT_RESPONSE | jq -r '.[0].project_id' 2>/dev/null)
              if [ "$FIRST_PROJECT_ID" != "null" ] && [ -n "$FIRST_PROJECT_ID" ]; then
                TODO_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/projects/$FIRST_PROJECT_ID/todo")
                TODO_COUNT=$(echo $TODO_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Todos found: $TODO_COUNT"
              fi
            fi
            
            # 9. ÏôÑÎ£åÎêú ÌîÑÎ°úÏ†ùÌä∏ Ï°∞Ìöå ÌÖåÏä§Ìä∏
            echo "üèÅ Testing completed projects..."
            COMPLETED_PROJECT_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/projects/completed")
            COMPLETED_PROJECT_COUNT=$(echo $COMPLETED_PROJECT_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
            echo "Completed projects found: $COMPLETED_PROJECT_COUNT"
            
            # 10. Í≤ÄÏÉâ Í∏∞Îä• ÌÖåÏä§Ìä∏
            echo "üîç Testing search functionality..."
            SEARCH_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/search?q=ÌÖåÏä§Ìä∏")
            SEARCH_COUNT=$(echo $SEARCH_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
            echo "Search results found: $SEARCH_COUNT"
            
            # 11. Ïä§ÌÅ¨Îû© Ï°∞Ìöå ÌÖåÏä§Ìä∏
            echo "üìå Testing scrap endpoints..."
            SCRAP_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/scraps/recruitments")
            SCRAP_COUNT=$(echo $SCRAP_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
            echo "Scraps found: $SCRAP_COUNT"
            
            # 12. ÌÉÄÏûÑÎùºÏù∏ Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÌîÑÎ°úÏ†ùÌä∏Ïùò ÌÉÄÏûÑÎùºÏù∏)
            if [ "$PROJECT_COUNT" -gt 0 ]; then
              echo "üìÖ Testing timeline endpoints..."
              FIRST_PROJECT_ID=$(echo $PROJECT_RESPONSE | jq -r '.[0].project_id' 2>/dev/null)
              if [ "$FIRST_PROJECT_ID" != "null" ] && [ -n "$FIRST_PROJECT_ID" ]; then
                TIMELINE_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/projects/$FIRST_PROJECT_ID/timeline")
                TIMELINE_COUNT=$(echo $TIMELINE_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
                echo "Timeline events found: $TIMELINE_COUNT"
              fi
            fi
            
            # 13. ÌîÑÎ°úÌïÑ Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©ÏûêÏùò ÌîÑÎ°úÌïÑ)
            echo "üë§ Testing profile endpoints..."
            FIRST_USER_ID=$(echo $USER_RESPONSE | jq -r '.[0].user_id' 2>/dev/null)
            if [ "$FIRST_USER_ID" != "null" ] && [ -n "$FIRST_USER_ID" ]; then
              PROFILE_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/profile/$FIRST_USER_ID")
              echo "Profile data: $(echo $PROFILE_RESPONSE | jq -r '.username // "N/A"' 2>/dev/null)"
            fi
            
            # 14. ÌèâÏ†ê Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©ÏûêÏùò ÌèâÏ†ê)
            if [ "$FIRST_USER_ID" != "null" ] && [ -n "$FIRST_USER_ID" ]; then
              echo "‚≠ê Testing rating endpoints..."
              RATING_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/profile/$FIRST_USER_ID/ratings")
              RATING_COUNT=$(echo $RATING_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
              echo "Ratings found: $RATING_COUNT"
            fi
            
            # 15. ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÏ†ùÌä∏ Ï°∞Ìöå ÌÖåÏä§Ìä∏ (Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö©ÏûêÏùò ÌîÑÎ°úÏ†ùÌä∏)
            if [ "$FIRST_USER_ID" != "null" ] && [ -n "$FIRST_USER_ID" ]; then
              echo "üìã Testing user projects endpoints..."
              USER_PROJECT_RESPONSE=$(curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/api/profile/$FIRST_USER_ID/projects")
              USER_PROJECT_COUNT=$(echo $USER_PROJECT_RESPONSE | jq '. | length' 2>/dev/null || echo '0')
              echo "User projects found: $USER_PROJECT_COUNT"
            fi
            
            echo "üéâ All seed data tests completed successfully!"
            echo "üìä Test Summary:"
            echo "   - Users: $(echo $USER_RESPONSE | jq '. | length' 2>/dev/null || echo 'N/A')"
            echo "   - Recruitments: $RECRUITMENT_COUNT"
            echo "   - Projects: $PROJECT_COUNT"
            echo "   - Comments: $COMMENT_COUNT"
            echo "   - Applications: $APPLICATION_COUNT"
            echo "   - Reviews: $REVIEW_COUNT"
            echo "   - Team Members: $MEMBER_COUNT"
            echo "   - Todos: $TODO_COUNT"
            echo "   - Completed Projects: $COMPLETED_PROJECT_COUNT"
            echo "   - Search Results: $SEARCH_COUNT"
            echo "   - Scraps: $SCRAP_COUNT"
            echo "   - Timeline Events: $TIMELINE_COUNT"
            echo "   - Ratings: $RATING_COUNT"
            echo "   - User Projects: $USER_PROJECT_COUNT"
            
          else
            echo "‚ö†Ô∏è  Login failed, but deployment is still successful"
            echo "üí° This might be due to seed data not being available in production"
          fi
        continue-on-error: true
