{
  "name": "학교 데이터 통일 스크립트",
  "description": "sjwoo1999@korea.ac.kr 소유 프로젝트의 지원자/멤버를 고려대학교로 통일",
  "created": "2026-01-26",
  "target_user": {
    "email": "sjwoo1999@korea.ac.kr",
    "university": "고려대학교"
  },

  "queries": {
    "step1_find_target_user": {
      "description": "대상 사용자 조회",
      "sql": "SELECT user_id, email, university FROM users WHERE email = 'sjwoo1999@korea.ac.kr'",
      "expected": {
        "university": "고려대학교"
      }
    },

    "step2_find_recruitments": {
      "description": "해당 사용자가 생성한 모집공고 조회",
      "sql": "SELECT recruitment_id, title FROM recruitments WHERE user_id = :target_user_id",
      "expected": {
        "count_gte": 0
      }
    },

    "step3_find_applicants_other_schools": {
      "description": "다른 학교 지원자 조회",
      "sql": "SELECT DISTINCT u.user_id, u.email, u.university FROM applications a JOIN users u ON a.user_id = u.user_id WHERE a.recruitment_id IN (SELECT recruitment_id FROM recruitments WHERE user_id = :target_user_id) AND (u.university IS NULL OR u.university != '고려대학교')",
      "note": "고려대학교가 아닌 지원자만 조회"
    },

    "step4_find_project_members_other_schools": {
      "description": "다른 학교 프로젝트 멤버 조회",
      "sql": "SELECT DISTINCT u.user_id, u.email, u.university FROM project_members pm JOIN users u ON pm.user_id = u.user_id JOIN projects p ON pm.project_id = p.project_id WHERE p.user_id = :target_user_id AND (u.university IS NULL OR u.university != '고려대학교')",
      "note": "고려대학교가 아닌 프로젝트 멤버만 조회"
    },

    "step5_update_university": {
      "description": "학교 정보 업데이트",
      "sql": "UPDATE users SET university = '고려대학교', updated_at = NOW() WHERE user_id IN (:user_ids_to_update)",
      "condition": "step3과 step4에서 조회된 user_id 대상"
    }
  },

  "seeder_template": {
    "file": "src/seeders/20260126-unify-school-data.js",
    "operations": [
      "조회: sjwoo1999@korea.ac.kr의 user_id 가져오기",
      "조회: 해당 사용자의 모집공고 목록",
      "조회: 지원자 중 다른 학교 사용자",
      "조회: 프로젝트 멤버 중 다른 학교 사용자",
      "삭제: 학교 미설정 사용자의 모집공고",
      "업데이트: 조회된 사용자들의 university를 '고려대학교'로 변경",
      "로깅: 변경된 사용자 수 출력"
    ]
  },

  "verification": {
    "before": "SELECT COUNT(*) as cnt, university FROM users WHERE user_id IN (SELECT DISTINCT user_id FROM applications WHERE recruitment_id IN (SELECT recruitment_id FROM recruitments WHERE user_id = (SELECT user_id FROM users WHERE email = 'sjwoo1999@korea.ac.kr'))) GROUP BY university",
    "after": "위 쿼리 재실행하여 모두 '고려대학교'인지 확인"
  },

  "policies": {
    "non_logged_in_user": "로그인 필수 - 모집공고 목록 접근 불가",
    "null_university_recruitment": "테스트 데이터이므로 삭제 처리"
  },

  "execution": {
    "command": "npx sequelize-cli db:seed --seed 20260126-unify-school-data.js",
    "rollback_note": "롤백 미지원 - 원본 데이터 복원 필요 시 백업 필요"
  }
}
