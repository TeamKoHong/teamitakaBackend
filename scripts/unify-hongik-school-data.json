{
  "name": "학교 데이터 통일 스크립트 - 홍익대",
  "description": "hongik@hongik.ac.kr 소유 프로젝트의 지원자/멤버를 홍익대학교로 통일",
  "created": "2026-01-26",
  "target_user": {
    "email": "hongik@hongik.ac.kr",
    "university": "홍익대학교"
  },

  "context": {
    "school_identity": "예술과 디자인의 중심, 홍익대학교",
    "typical_projects": ["UX/UI 스터디", "브랜딩 프로젝트", "포트폴리오 팀", "전시 기획", "시각디자인 협업"]
  },

  "queries": {
    "step1_find_target_user": {
      "description": "대상 사용자 조회",
      "sql": "SELECT user_id, email, university FROM users WHERE email = 'hongik@hongik.ac.kr'",
      "expected": {
        "university": "홍익대학교"
      }
    },

    "step2_find_recruitments": {
      "description": "해당 사용자가 생성한 모집공고 조회",
      "sql": "SELECT recruitment_id, title FROM recruitments WHERE user_id = :target_user_id",
      "example_titles": [
        "[홍익대] UX/UI 포트폴리오 팀원 모집",
        "[홍대] 브랜딩 스터디 함께해요",
        "[디자인] 전시 기획 프로젝트 참여자 구함"
      ],
      "expected": {
        "count_gte": 0
      }
    },

    "step3_find_applicants_other_schools": {
      "description": "다른 학교 지원자 조회",
      "sql": "SELECT DISTINCT u.user_id, u.email, u.university FROM applications a JOIN users u ON a.user_id = u.user_id WHERE a.recruitment_id IN (SELECT recruitment_id FROM recruitments WHERE user_id = :target_user_id) AND (u.university IS NULL OR u.university != '홍익대학교')",
      "note": "홍익대학교가 아닌 지원자만 조회 - 디자인 협업 특성상 타 학교 지원자가 많을 수 있음"
    },

    "step4_find_project_members_other_schools": {
      "description": "다른 학교 프로젝트 멤버 조회",
      "sql": "SELECT DISTINCT u.user_id, u.email, u.university FROM project_members pm JOIN users u ON pm.user_id = u.user_id JOIN projects p ON pm.project_id = p.project_id WHERE p.user_id = :target_user_id AND (u.university IS NULL OR u.university != '홍익대학교')",
      "note": "홍익대학교가 아닌 프로젝트 멤버만 조회"
    },

    "step5_update_university": {
      "description": "학교 정보 업데이트",
      "sql": "UPDATE users SET university = '홍익대학교', updated_at = NOW() WHERE user_id IN (:user_ids_to_update)",
      "condition": "step3과 step4에서 조회된 user_id 대상"
    }
  },

  "seeder_template": {
    "file": "src/seeders/20260126-unify-hongik-school-data.js",
    "operations": [
      "조회: hongik@hongik.ac.kr의 user_id 가져오기",
      "조회: 해당 사용자의 모집공고 목록 (UX 스터디, 포트폴리오 팀 등)",
      "조회: 지원자 중 다른 학교 사용자",
      "조회: 프로젝트 멤버 중 다른 학교 사용자",
      "삭제: 학교 미설정 사용자의 모집공고 (선택적)",
      "업데이트: 조회된 사용자들의 university를 '홍익대학교'로 변경",
      "로깅: 변경된 사용자 수 출력"
    ]
  },

  "verification": {
    "before": "SELECT COUNT(*) as cnt, university FROM users WHERE user_id IN (SELECT DISTINCT user_id FROM applications WHERE recruitment_id IN (SELECT recruitment_id FROM recruitments WHERE user_id = (SELECT user_id FROM users WHERE email = 'hongik@hongik.ac.kr'))) GROUP BY university",
    "after": "위 쿼리 재실행하여 모두 '홍익대학교'인지 확인",
    "sample_check": "SELECT title, university FROM recruitments r JOIN users u ON r.user_id = u.user_id WHERE u.email = 'hongik@hongik.ac.kr'"
  },

  "policies": {
    "non_logged_in_user": "로그인 필수 - 모집공고 목록 접근 불가",
    "null_university_recruitment": "테스트 데이터이므로 삭제 처리",
    "cross_school_collaboration": "디자인 특성상 타 학교 협업 빈번 - 교내 모드에서 홍익대로 통일"
  },

  "execution": {
    "command": "npx sequelize-cli db:seed --seed 20260126-unify-hongik-school-data.js",
    "rollback_note": "롤백 미지원 - 원본 데이터 복원 필요 시 백업 필요"
  },

  "test_scenarios": {
    "filter_hongik": "curl -s http://localhost:3000/api/recruitments | jq '[.[] | select(.university == \"홍익대학교\")]'",
    "count_hongik": "curl -s http://localhost:3000/api/recruitments | jq '[.[] | select(.university == \"홍익대학교\")] | length'"
  }
}
